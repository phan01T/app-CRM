<div class="invoice-wrapper">
  <h2>H√≥a ƒë∆°n</h2>

  <div class="search-bar">
    <input placeholder="T√¨m theo kh√°ch h√†ng, s·ªë h√≥a ƒë∆°n..." />
    <select [(ngModel)]="filterStatus">
      <option>T·∫•t c·∫£</option>
      <option>ƒêang ch·ªù</option>
      <option>ƒê√£ thanh to√°n</option>
      <option>Qu√° h·∫°n</option>
    </select>
    <button class="add-btn" (click)="openCreateModal()">+ T·∫°o h√≥a ƒë∆°n</button>
  </div>

  <!-- DANH S√ÅCH H√ìA ƒê∆†N -->
  <table class="invoice-table">
    <thead>
      <tr>
        <th>Kh√°ch h√†ng</th>
        <th>S·ªë h√≥a ƒë∆°n</th>
        <th>S·ªë ti·ªÅn</th>
        <th>Ng√†y ƒë·∫øn h·∫°n</th>
        <th>Tr·∫°ng th√°i</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let inv of filteredInvoices()">
        <td>{{ inv.customer }}</td>
        <td>{{ inv.code }}</td>
        <td>{{ inv.amount }}</td>
        <td>{{ inv.dueDate }}</td>
        <td>
          <span class="status" [ngClass]="inv.status">{{ inv.status }}</span>
        </td>
        <td>
          <button
            class="link-btn"
            *ngIf="inv.status === 'ƒê√£ thanh to√°n'"
            (click)="viewInvoice(inv.code)"
          >
            Xem
          </button>
          <button
            class="link-btn"
            *ngIf="inv.status === 'Qu√° h·∫°n'"
            (click)="remindInvoice(inv.code)"
          >
            G·ª≠i nh·∫Øc nh·ªü
          </button>
          <button
            class="link-btn"
            *ngIf="inv.status === 'ƒêang ch·ªù'"
            (click)="sendPendingInvoice(inv.code)"
          >
            G·ª≠i
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- T·∫†O H√ìA ƒê∆†N NHANH -->
  <div class="create-section">
    <div class="form">
      <h3>T·∫°o h√≥a ƒë∆°n nhanh</h3>
      <label>Kh√°ch h√†ng</label>
      <input placeholder="Ch·ªçn kh√°ch h√†ng" [(ngModel)]="newInvoice.customer" />

      <label>Ng√†y ƒë·∫øn h·∫°n</label>
      <input type="date" [(ngModel)]="newInvoice.dueDate" />

      <label>D√≤ng s·∫£n ph·∫©m</label>
      <div
        class="item-row"
        *ngFor="let item of newInvoice.items; let i = index"
      >
        <input placeholder="M√¥ t·∫£" [(ngModel)]="item.desc" />
        <input type="number" placeholder="SL" [(ngModel)]="item.qty" />
        <input type="number" placeholder="Gi√°" [(ngModel)]="item.price" />
        <button (click)="removeItem(i)">üóë</button>
      </div>

      <button class="add-row-btn" (click)="addItem()">Ôºã Th√™m d√≤ng</button>

      <div class="total">
        T·ªïng ti·ªÅn: {{ calcTotal() | number : "1.0-0" }} {{ settings.currency }}
      </div>

      <button (click)="createInvoice()">G·ª≠i h√≥a ƒë∆°n</button>
    </div>

    <div class="settings">
      <h3>Thi·∫øt l·∫≠p h√≥a ƒë∆°n</h3>
      <label>M·∫´u h√≥a ƒë∆°n</label>
      <select [(ngModel)]="settings.template">
        <option>T·ªëi gi·∫£n</option>
        <option>Chi ti·∫øt</option>
      </select>

      <label>Ti·ªÅn t·ªá</label>
      <select [(ngModel)]="settings.currency">
        <option>USD</option>
        <option>VND</option>
      </select>

      <label>T·ª± ƒë·ªông nh·∫Øc nh·ªü</label>
      <input type="checkbox" [(ngModel)]="settings.autoReminder" />

      <label>Ng√¥n ng·ªØ</label>
      <select [(ngModel)]="settings.language">
        <option>Ti·∫øng Vi·ªát</option>
        <option>English</option>
      </select>

      <label>G·ª≠i qua Email</label>
      <input [(ngModel)]="settings.smtp" />

      <label>ƒê·ªãnh d·∫°ng PDF</label>
      <select [(ngModel)]="settings.pdf">
        <option>Chu·∫©n A4</option>
        <option>Compact</option>
      </select>
    </div>
  </div>

  <!-- NG∆Ø·ªúI D√ôNG -->
  <div class="user-section">
    <h3>Qu·∫£n l√Ω ng∆∞·ªùi d√πng (Admin)</h3>
    <table>
      <thead>
        <tr>
          <th>Ng∆∞·ªùi d√πng</th>
          <th>Email</th>
          <th>Vai tr√≤</th>
          <th>Tr·∫°ng th√°i</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of users()">
          <td>{{ u.name }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.role }}</td>
          <td>
            <span class="status" [ngClass]="u.status">{{ u.status }}</span>
          </td>
          <td>
            <button class="link-btn">S·ª≠a</button>
            <button class="link-btn danger">V√¥ hi·ªáu</button>
          </td>
        </tr>
      </tbody>
    </table>
    <button class="add-btn" (click)="openUserModal()">+ Th√™m ng∆∞·ªùi d√πng</button>
  </div>
</div>

<!-- MODAL: T·∫†O H√ìA ƒê∆†N -->
<div class="modal" *ngIf="showCreateInvoice">
  <div class="modal-content">
    <h3>üßæ T·∫°o h√≥a ƒë∆°n m·ªõi</h3>
    <label>Kh√°ch h√†ng</label>
    <input [(ngModel)]="newInvoice.customer" placeholder="T√™n kh√°ch h√†ng" />

    <label>Ng√†y ƒë·∫øn h·∫°n</label>
    <input type="date" [(ngModel)]="newInvoice.dueDate" />

    <label>D√≤ng s·∫£n ph·∫©m</label>
    <div class="item-row" *ngFor="let item of newInvoice.items; let i = index">
      <input placeholder="M√¥ t·∫£" [(ngModel)]="item.desc" />
      <input type="number" placeholder="SL" [(ngModel)]="item.qty" />
      <input type="number" placeholder="Gi√°" [(ngModel)]="item.price" />
      <button (click)="removeItem(i)">üóë</button>
    </div>

    <button class="add-row-btn" (click)="addItem()">Ôºã Th√™m d√≤ng</button>

    <div class="total">
      T·ªïng ti·ªÅn: {{ calcTotal() | number : "1.0-0" }} {{ settings.currency }}
    </div>

    <div class="actions">
      <button (click)="createInvoice()">T·∫°o h√≥a ƒë∆°n</button>
      <button class="cancel" (click)="closeModals()">H·ªßy</button>
    </div>
  </div>
</div>

<!-- MODAL: TH√äM NG∆Ø·ªúI D√ôNG -->
<div class="modal" *ngIf="showCreateUser">
  <div class="modal-content">
    <h3>üë§ Th√™m ng∆∞·ªùi d√πng</h3>
    <label>H·ªç t√™n</label>
    <input [(ngModel)]="newUser.name" />
    <label>Email</label>
    <input [(ngModel)]="newUser.email" />
    <label>Vai tr√≤</label>
    <select [(ngModel)]="newUser.role">
      <option>Qu·∫£n tr·ªã</option>
      <option>K·∫ø to√°n</option>
    </select>
    <div class="actions">
      <button (click)="addUser()">Th√™m</button>
      <button class="cancel" (click)="closeModals()">ƒê√≥ng</button>
    </div>
  </div>
</div>
