<!-- ===============================
     üìã DANH S√ÅCH C∆† H·ªòI (Dynamic)
     =============================== -->
<section class="card opportunity-list">
  <div class="header">
    <h3>Danh s√°ch c∆° h·ªôi</h3>
    <button class="btn primary" (click)="openCreateModal()">
      Ôºã C∆° h·ªôi m·ªõi
    </button>
  </div>

  <table class="opp-table" *ngIf="opportunities.length > 0; else noData">
    <thead>
      <tr>
        <th>T√™n c∆° h·ªôi</th>
        <th>T√†i kho·∫£n</th>
        <th>Giai ƒëo·∫°n</th>
        <th>X√°c su·∫•t</th>
        <th>Gi√° tr·ªã</th>
        <th>Ng√†y ch·ªët</th>
        <th>Thao t√°c</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let opp of opportunities"
        [class.active]="opp.id === opportunity.id"
      >
        <td (click)="selectOpportunity(opp)">{{ opp.name }}</td>
        <td (click)="selectOpportunity(opp)">{{ opp.account }}</td>
        <td>{{ opp.stage }}</td>
        <td>{{ opp.probability }}%</td>
        <td>{{ opp.value | currency : "USD" }}</td>
        <td>{{ opp.closeDate }}</td>
        <td class="actions">
          <button
            class="btn view"
            (click)="selectOpportunity(opp); $event.stopPropagation()"
          >
            üëÅ
          </button>
          <button
            class="btn delete"
            (click)="deleteOpportunity(opp); $event.stopPropagation()"
          >
            üóë
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #noData>
    <p class="empty">Ch∆∞a c√≥ c∆° h·ªôi n√†o ƒë∆∞·ª£c t·∫°o.</p>
  </ng-template>
</section>

<!-- ===============================
     ü™Ñ MODAL T·∫†O C∆† H·ªòI (Reactive)
     =============================== -->
<div class="modal-backdrop" *ngIf="showCreateModal">
  <div class="modal">
    <div class="modal-header">
      <h3>C∆° h·ªôi m·ªõi</h3>
      <span class="step">B∆∞·ªõc 1/1 ‚Ä¢ T·∫°o c∆° h·ªôi b√°n h√†ng</span>
    </div>

    <form [formGroup]="opportunityForm" class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>T√™n c∆° h·ªôi</label>
          <input
            type="text"
            formControlName="name"
            placeholder="V√≠ d·ª•: H·ª£p ƒë·ªìng nƒÉm Globex"
          />
        </div>
        <div class="form-group">
          <label>Kh√°ch h√†ng</label>
          <input
            type="text"
            formControlName="account"
            placeholder="Ch·ªçn kh√°ch h√†ng..."
          />
        </div>
        <div class="form-group">
          <label>Gi√° tr·ªã d·ª± ki·∫øn ($)</label>
          <input type="number" formControlName="value" />
        </div>
        <div class="form-group">
          <label>Giai ƒëo·∫°n</label>
          <input type="text" formControlName="stage" />
        </div>
      </div>

      <div class="form-group">
        <label>Ghi ch√∫ / B∆∞·ªõc ti·∫øp theo</label>
        <textarea
          formControlName="note"
          placeholder="Th√™m b·ªëi c·∫£nh ho·∫∑c b∆∞·ªõc ti·∫øp theo..."
        ></textarea>
      </div>
    </form>

    <div class="modal-footer">
      <button class="btn" (click)="closeCreateModal()">‚úñ ƒê√≥ng</button>
      <button class="btn primary" (click)="saveNewOpportunity()">
        Ôºã T·∫°o c∆° h·ªôi
      </button>
    </div>
  </div>
</div>

<!-- ===============================
     üß© CHI TI·∫æT C∆† H·ªòI (Dynamic)
     =============================== -->
<div class="opportunity-detail" *ngIf="opportunity">
  <div class="row">
    <section class="overview card">
      <div class="header">
        <h3>T·ªïng quan c∆° h·ªôi</h3>
        <div class="avatars">
          <img src="https://i.pravatar.cc/32?img=10" />
          <img src="https://i.pravatar.cc/32?img=11" />
          <img src="https://i.pravatar.cc/32?img=12" />
        </div>
      </div>

      <div class="grid-info">
        <p><strong>T√™n giao d·ªãch:</strong> {{ opportunity.name }}</p>
        <p><strong>Ng√†y ch·ªët:</strong> {{ opportunity.closeDate }}</p>
        <p><strong>T√†i kho·∫£n:</strong> {{ opportunity.account }}</p>
        <p><strong>X√°c su·∫•t:</strong> {{ opportunity.probability }}%</p>
        <p><strong>Giai ƒëo·∫°n:</strong> {{ opportunity.stage }}</p>
        <p class="value">
          <strong>Gi√° tr·ªã:</strong> {{ opportunity.value | currency : "USD" }}
        </p>
      </div>

      <div class="stage-progress">
        <p><b>Ti·∫øn ƒë·ªô giai ƒëo·∫°n</b></p>
        <div class="progress">
          <div class="bar" [style.width.%]="opportunity.probability"></div>
        </div>
        <div class="stages">Kh√°m ph√° ‚Üí ƒê·ªÅ xu·∫•t ‚Üí ƒê√†m ph√°n ‚Üí Duy·ªát ‚Üí ƒê√≥ng</div>
        <span class="percent">{{ opportunity.probability }}%</span>
      </div>

      <div class="contact">
        <h4>Li√™n h·ªá ch√≠nh</h4>
        <div class="person">
          <img [src]="opportunity.contact.avatar" />
          <div>
            <p class="name">{{ opportunity.contact.name }}</p>
            <p class="title">{{ opportunity.contact.title }}</p>
          </div>
        </div>
      </div>

      <div class="competitors">
        <h4>ƒê·ªëi th·ªß</h4>
        <div class="tags">
          <span *ngFor="let c of opportunity.competitors" class="tag">{{
            c
          }}</span>
        </div>
      </div>

      <div class="next-step">
        <h4>B∆∞·ªõc ti·∫øp theo</h4>
        <p>{{ opportunity.nextStep }}</p>
      </div>

      <div class="attachments">
        <h4>T·ªáp ƒë√≠nh k√®m</h4>
        <div *ngFor="let file of opportunity.attachments" class="file">
          <span>üìÑ {{ file.name }}</span>
          <span class="size">{{ file.size }}</span>
        </div>
      </div>
    </section>

    <section class="card context">
      <h3>Ng·ªØ c·∫£nh kh√°ch h√†ng</h3>
      <img src="https://picsum.photos/400/180" alt="customer" />
      <p><strong>Khu v·ª±c:</strong> Vi·ªát Nam</p>
      <p><strong>Ng√†nh:</strong> Logistics</p>
      <div class="actions">
        <button class="btn primary">üìû Ghi log cu·ªôc g·ªçi</button>
        <button class="btn">‚úâÔ∏è G·ª≠i email</button>
        <button class="btn">üìÖ L√™n l·ªãch</button>
      </div>
    </section>
  </div>

  <div class="row">
    <section class="card activities">
      <h3>D√≤ng ho·∫°t ƒë·ªông</h3>
      <ul>
        <li>ƒê√£ chia s·∫ª ƒë·ªÅ xu·∫•t v3 (H√¥m qua)</li>
        <li>ƒê√£ nh·∫≠n c√¢u h·ªèi b·∫£o m·∫≠t (2 ng√†y tr∆∞·ªõc)</li>
        <li>Ho√†n t·∫•t cu·ªôc g·ªçi kh√°m ph√° (2 Thg 10)</li>
      </ul>
      <input type="text" placeholder="Th√™m ghi ch√∫..." />
      <button class="btn">Th√™m</button>
    </section>

    <section class="card related">
      <h3>C∆° h·ªôi li√™n quan</h3>
      <div class="tabs">
        <span class="tab active">B√°n tƒÉng</span>
        <span class="tab">B√°n ch√©o</span>
        <span class="tab">Gia h·∫°n</span>
      </div>
      <div class="mini-cards">
        <div class="mini-card">
          <p>H·ªó tr·ª£ Premium</p>
          <span>$9,600</span>
        </div>
        <div class="mini-card">
          <p>T·ª± ƒë·ªông h√≥a Quy tr√¨nh</p>
          <span>$18,000</span>
        </div>
        <div class="mini-card">
          <p>Globex H√†ng nƒÉm</p>
          <span>$54,000</span>
        </div>
      </div>
    </section>
  </div>
</div>
