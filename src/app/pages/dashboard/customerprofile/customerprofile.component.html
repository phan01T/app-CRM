<div class="page-header">
  <h2>Customer Records</h2>

  <div class="actions">
    <button
      class="btn"
      [class.primary]="activeTab === 'contact'"
      (click)="activeTab = 'contact'"
    >
      üë§ Li√™n h·ªá
    </button>
    <button
      class="btn"
      [class.primary]="activeTab === 'company'"
      (click)="activeTab = 'company'"
    >
      üè¢ C√¥ng ty
    </button>
    <button class="btn primary" (click)="handleAction('create')">
      ‚ûï T·∫°o m·ªõi
    </button>
  </div>
</div>

<div class="customer-profile">
  <div class="main-content">
    <!-- ================= LEFT SIDE ================= -->
    <div class="left-section">
      <!-- Filter -->
      <div class="tabs">
        <input
          [(ngModel)]="searchText"
          placeholder="T√¨m ki·∫øm theo t√™n, email, ƒëi·ªán tho·∫°i..."
          class="filter"
        />
        <button class="btn" (click)="handleAction('filter')">L·ªçc</button>
      </div>

      <!-- CONTACTS TABLE -->
      <div class="card-table" *ngIf="activeTab === 'contact'">
        <h3>Danh s√°ch li√™n h·ªá</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>STT</th>
              <th *ngFor="let f of fieldsContact">{{ f.label }}</th>
              <th>Thao t√°c</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of filteredContacts; let i = index">
              <td>{{ i + 1 }}</td>
              <td *ngFor="let f of fieldsContact">{{ c[f.key] }}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn small-1" (click)="handleAction('edit', c)">
                    S·ª≠a
                  </button>
                  <button class="btn small" (click)="handleAction('delete', c)">
                    X√≥a
                  </button>
                  <button
                    class="btn secondary small"
                    (click)="handleAction('lock', c)"
                  >
                    {{ c.locked ? "M·ªü kh√≥a" : "Kh√≥a" }}
                  </button>
                </div>
              </td>
              <td>
                <span
                  [style.color]="c.locked ? '#d93025' : '#188038'"
                  style="font-weight: 500"
                >
                  {{ c.locked ? "ƒê√£ kh√≥a" : "Ho·∫°t ƒë·ªông" }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- COMPANIES TABLE -->
      <div class="card-table" *ngIf="activeTab === 'company'">
        <h3>Danh s√°ch c√¥ng ty</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>STT</th>
              <th *ngFor="let f of fieldsCompany">{{ f.label }}</th>
              <th>Thao t√°c</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of filteredCompanies; let i = index">
              <td>{{ i + 1 }}</td>
              <td *ngFor="let f of fieldsCompany">{{ c[f.key] }}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn small-1" (click)="handleAction('edit', c)">
                    S·ª≠a
                  </button>
                  <button class="btn small" (click)="handleAction('delete', c)">
                    X√≥a
                  </button>
                  <button
                    class="btn secondary small"
                    (click)="handleAction('lock', c)"
                  >
                    {{ c.locked ? "M·ªü kh√≥a" : "Kh√≥a" }}
                  </button>
                </div>
              </td>
              <td>
                <span
                  [style.color]="c.locked ? '#d93025' : '#188038'"
                  style="font-weight: 500"
                >
                  {{ c.locked ? "ƒê√£ kh√≥a" : "Ho·∫°t ƒë·ªông" }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ================= RIGHT SIDE ================= -->
    <div class="right-section">
      <!-- CONTACT FORM -->
      <form
        *ngIf="activeTab === 'contact'"
        [formGroup]="profileForm"
        class="profile-form"
      >
        <h3>Th√¥ng tin li√™n h·ªá</h3>
        <div *ngFor="let f of fieldsContact">
          <label>{{ f.label }}</label>
          <input
            [formControlName]="f.key"
            [readonly]="editingContact?.locked"
            [placeholder]="'Nh·∫≠p ' + f.label.toLowerCase()"
          />
        </div>

        <div class="actions">
          <button class="btn primary" type="button" (click)="save()">
            üíæ L∆∞u
          </button>
          <button
            class="btn small"
            type="button"
            (click)="handleAction('delete', editingContact ?? undefined)"
            [disabled]="!editingContact"
          >
            üóëÔ∏è X√≥a
          </button>
          <button
            class="btn small secondary"
            type="button"
            (click)="handleAction('lock', editingContact ?? undefined)"
            [disabled]="!editingContact"
          >
            {{ editingContact?.locked ? "üîì M·ªü kh√≥a" : "üîí Kh√≥a" }}
          </button>
        </div>
      </form>

      <!-- COMPANY FORM -->
      <form
        *ngIf="activeTab === 'company'"
        [formGroup]="profileForm"
        class="profile-form"
      >
        <h3>Th√¥ng tin c√¥ng ty</h3>
        <div *ngFor="let f of fieldsCompany">
          <label>{{ f.label }}</label>
          <input
            [formControlName]="f.key"
            [readonly]="editingCompany?.locked"
            [placeholder]="'Nh·∫≠p ' + f.label.toLowerCase()"
          />
        </div>

        <div class="actions">
          <button class="btn primary" type="button" (click)="save()">
            üíæ L∆∞u
          </button>
          <button
            class="btn small"
            type="button"
            (click)="handleAction('delete', editingCompany ?? undefined)"
            [disabled]="!editingCompany"
          >
            üóëÔ∏è X√≥a
          </button>
          <button
            class="btn small secondary"
            type="button"
            (click)="handleAction('lock', editingCompany ?? undefined)"
            [disabled]="!editingCompany"
          >
            {{ editingCompany?.locked ? "üîì M·ªü kh√≥a" : "üîí Kh√≥a" }}
          </button>
        </div>
      </form>

      <!-- FILES -->
      <!-- FILES -->
      <div class="files">
        <h4>Files</h4>

        <!-- Hidden input ƒë·ªÉ upload -->
        <input
          type="file"
          #fileUpload
          (change)="onFileSelected($event)"
          multiple
          hidden
        />

        <div class="file-actions">
          <button class="btn small-1" (click)="fileUpload.click()">
            üì§ T·∫£i l√™n
          </button>
          <button
            class="btn small secondary"
            *ngIf="files.length"
            (click)="files = []"
          >
            üóëÔ∏è X√≥a t·∫•t c·∫£
          </button>
        </div>

        <ul>
          <li *ngFor="let f of files; let i = index">
            {{ f.name }} ({{ f.size }}) - {{ f.time }}
            <button (click)="removeFile(i)">‚ùå</button>
          </li>
        </ul>
      </div>

      <!-- COMPANY INFO VIEW -->
      <div
        class="company-info"
        *ngIf="activeTab === 'company' && editingCompany"
      >
        <h4>Chi ti·∫øt c√¥ng ty</h4>
        <div class="grid-2">
          <div *ngFor="let f of fieldsCompany" class="form-group">
            <label>{{ f.label }}</label>
            <input [value]="editingCompany[f.key]" readonly />
          </div>
        </div>

        <div class="tags">
          <span class="tag">enterprise</span>
          <span class="tag">vip</span>
        </div>

        <div class="actions">
          <button class="btn primary">L∆∞u</button>
          <button class="btn small">X√≥a</button>
          <button class="btn small">Kh√≥a</button>
          <button class="btn small secondary">H·ª£p nh·∫•t</button>
        </div>
      </div>
    </div>
  </div>
</div>
