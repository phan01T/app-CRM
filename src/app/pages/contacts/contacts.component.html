<div class="contacts-container">
  <!-- ===============================
       üìã DANH S√ÅCH H·ªí S∆† KH√ÅCH H√ÄNG
       =============================== -->
  <div class="header-section">
    <h3>Danh s√°ch h·ªì s∆° kh√°ch h√†ng</h3>
    <button class="btn primary" (click)="openModal()">üë§ T·∫°o h·ªì s∆°</button>
  </div>

  <table class="profile-table" *ngIf="profiles.length > 0; else noProfiles">
    <thead>
      <tr>
        <th>H·ªç v√† t√™n</th>
        <th>Email</th>
        <th>ƒêi·ªán tho·∫°i</th>
        <th>C√¥ng ty</th>
        <th>Vai tr√≤</th>
        <th>Ngu·ªìn</th>
        <th>Nh√¢n s·ª± li√™n quan</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of profiles">
        <td>{{ p.fullName }}</td>
        <td>{{ p.email }}</td>
        <td>{{ p.phone }}</td>
        <td>{{ p.company }}</td>
        <td>{{ p.role }}</td>
        <td>{{ p.source }}</td>
        <td>
          <div class="mini-avatars" *ngIf="p.employees?.length > 0">
            <img
              *ngFor="let e of p.employees"
              [src]="e.avatar"
              [title]="e.name"
              class="avatar-sm"
            />
          </div>
          <span *ngIf="!p.employees?.length">‚Äî</span>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #noProfiles>
    <p class="empty">Ch∆∞a c√≥ h·ªì s∆° n√†o ƒë∆∞·ª£c t·∫°o.</p>
  </ng-template>

  <!-- ===============================
       üìä TH·ªêNG K√ä KH√ÅCH H√ÄNG
       =============================== -->
  <div class="stats">
    <div class="card" *ngFor="let s of stats">
      <div class="label">{{ s.label }}</div>
      <div class="value">{{ s.value | number }}</div>
    </div>
  </div>

  <!-- ===============================
       ü™ü MODAL T·∫†O H·ªí S∆† KH√ÅCH H√ÄNG
       =============================== -->

  <div class="modal-backdrop" *ngIf="showModal">
    <div class="modal wide">
      <div class="modal-header">
        <h3>T·∫°o h·ªì s∆° kh√°ch h√†ng m·ªõi</h3>
        <button class="close" (click)="closeModal()">‚úñ</button>
      </div>

      <form [formGroup]="profileForm" class="modal-body">
        <!-- Th√¥ng tin c∆° b·∫£n -->
        <div class="grid-2">
          <div class="form-group">
            <label>H·ªç v√† t√™n</label>
            <input
              formControlName="fullName"
              class="form-control"
              placeholder="VD: Nguy·ªÖn Th·∫£o"
            />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input
              formControlName="email"
              class="form-control"
              placeholder="example@company.com"
            />
          </div>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label>ƒêi·ªán tho·∫°i</label>
            <input
              formControlName="phone"
              class="form-control"
              placeholder="+84 90 123 4567"
            />
          </div>
          <div class="form-group">
            <label>C√¥ng ty</label>
            <input
              formControlName="company"
              class="form-control"
              placeholder="C√¥ng ty ABC"
            />
          </div>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label>Vai tr√≤</label>
            <input
              formControlName="role"
              class="form-control"
              placeholder="Tr∆∞·ªüng ph√≤ng Mua h√†ng"
            />
          </div>
          <div class="form-group">
            <label>Ngu·ªìn</label>
            <input
              formControlName="source"
              class="form-control"
              placeholder="Website / Li√™n h·ªá"
            />
          </div>
        </div>

        <div class="form-group">
          <label>Ghi ch√∫ ban ƒë·∫ßu</label>
          <textarea
            formControlName="note"
            class="form-control"
            rows="2"
            placeholder="Quan t√¢m gi·∫£i ph√°p CRM..."
          ></textarea>
        </div>

        <!-- C∆° h·ªôi li√™n quan -->
        <h4>T·∫°o nhanh c∆° h·ªôi li√™n quan</h4>
        <div class="grid-2">
          <div class="form-group">
            <label>T√™n c∆° h·ªôi</label>
            <input
              formControlName="oppName"
              class="form-control"
              placeholder="Tri·ªÉn khai CRM cho C√¥ng ty ABC"
            />
          </div>
          <div class="form-group">
            <label>Giai ƒëo·∫°n</label>
            <input
              formControlName="stage"
              class="form-control"
              placeholder="Kh·∫£o s√°t / ƒê√†m ph√°n / K√Ω h·ª£p ƒë·ªìng"
            />
          </div>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label>Gi√° tr·ªã ∆∞·ªõc t√≠nh</label>
            <input
              formControlName="amount"
              class="form-control"
              placeholder="250,000,000 VND"
            />
          </div>
          <div class="form-group">
            <label>Th·ªùi h·∫°n</label>
            <input
              formControlName="deadline"
              type="date"
              class="form-control"
            />
          </div>
        </div>

        <!-- Ch·ªçn nh√¢n s·ª± li√™n quan -->
        <h4>Ch·ªçn nh√¢n s·ª± li√™n quan</h4>
        <table class="employee-table mini">
          <thead>
            <tr>
              <th>Ch·ªçn</th>
              <th>T√™n</th>
              <th>Ch·ª©c danh</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emp of employees">
              <td>
                <input
                  type="checkbox"
                  (change)="onCheckboxChange(emp, $event)"
                />
              </td>
              <td>
                <div class="emp-info">
                  <img [src]="emp.avatar" class="avatar" />
                  <div>
                    <div class="name">{{ emp.name }}</div>
                    <div class="owner">Owner: {{ emp.owner }}</div>
                  </div>
                </div>
              </td>
              <td>{{ emp.role }}</td>
              <td>{{ emp.email }}</td>
            </tr>
          </tbody>
        </table>
      </form>

      <div class="modal-footer">
        <button class="btn" (click)="closeModal()">H·ªßy</button>
        <button class="btn primary" (click)="saveProfile()">
          üíæ L∆∞u h·ªì s∆°
        </button>
      </div>
    </div>
  </div>

  <!-- ===============================
     üë• NH√ÇN S·ª∞ LI√äN QUAN (QU·∫¢N L√ù T·ªîNG)
     =============================== -->
  <h3>Nh√¢n s·ª± li√™n quan (Qu·∫£n l√Ω t·ªïng)</h3>

  <div class="toolbar">
    <button class="btn light" (click)="openGroupManager()">
      üë• Qu·∫£n l√Ω nh√≥m
    </button>
    <button class="btn primary" (click)="openEmployeeModal()">
      ‚ûï Th√™m nh√¢n s·ª±
    </button>
  </div>

  <table class="employee-table">
    <thead>
      <tr>
        <th>T√™n</th>
        <th>Ch·ª©c danh</th>
        <th>Ph√≤ng ban</th>
        <th>Email</th>
        <th>Thao t√°c</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let emp of employees">
        <td>
          <div class="emp-info">
            <img [src]="emp.avatar" class="avatar" />
            <div>
              <div class="name">{{ emp.name }}</div>
              <div class="owner">Owner: {{ emp.owner }}</div>
            </div>
          </div>
        </td>
        <td>{{ emp.role }}</td>
        <td>{{ emp.department }}</td>
        <td>{{ emp.email }}</td>
        <td class="actions">
          <button class="btn view" (click)="onView(emp)">üëÅ Xem</button>
          <button class="btn edit" (click)="openEmployeeModal(emp)">
            ‚úèÔ∏è S·ª≠a
          </button>
          <button class="btn delete" (click)="deleteEmployee(emp)">
            üóë X√≥a
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <p class="footer">Hi·ªÉn th·ªã {{ employees.length }} nh√¢n s·ª± trong h·ªá th·ªëng</p>

  <!-- ===============================
     ü™ü MODAL TH√äM / S·ª¨A NH√ÇN S·ª∞
     =============================== -->
  <div class="modal-backdrop" *ngIf="showEmployeeModal">
    <div class="modal small">
      <div class="modal-header">
        <h3>{{ editingEmployee ? "C·∫≠p nh·∫≠t nh√¢n s·ª±" : "Th√™m nh√¢n s·ª± m·ªõi" }}</h3>
        <button class="close" (click)="closeEmployeeModal()">‚úñ</button>
      </div>

      <form
        [formGroup]="employeeForm"
        (ngSubmit)="saveEmployee()"
        class="modal-body"
      >
        <div class="form-group">
          <label>H·ªç v√† t√™n</label>
          <input
            formControlName="name"
            class="form-control"
            placeholder="VD: Nguy·ªÖn VƒÉn A"
          />
        </div>

        <div class="form-group">
          <label>Ch·ª©c danh</label>
          <input
            formControlName="role"
            class="form-control"
            placeholder="VD: Sales Manager"
          />
        </div>

        <div class="form-group">
          <label>Ph√≤ng ban</label>
          <input
            formControlName="department"
            class="form-control"
            placeholder="VD: Sales"
          />
        </div>

        <div class="form-group">
          <label>Email</label>
          <input
            formControlName="email"
            class="form-control"
            placeholder="example@company.com"
          />
        </div>

        <div class="form-group">
          <label>Owner</label>
          <input
            formControlName="owner"
            class="form-control"
            placeholder="VD: B·∫°n / Minh / Huy·ªÅn..."
          />
        </div>

        <div class="modal-footer">
          <button type="button" class="btn" (click)="closeEmployeeModal()">
            H·ªßy
          </button>
          <button type="submit" class="btn primary">
            üíæ {{ editingEmployee ? "L∆∞u thay ƒë·ªïi" : "L∆∞u nh√¢n s·ª±" }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
